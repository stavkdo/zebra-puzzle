<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Find the Zebra</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Responsive sizing knobs (tweak if you want things larger/smaller) */
      --gap: clamp(8px, 2.5vw, 24px);
      --box: clamp(44px, 12vw, 60px);        /* drop-box & house size */
      --charW: clamp(30px, 8.5vw, 48px);     /* character width */
      --charH: calc(var(--charW) * (62/48)); /* keep original char ratio */
      --animal: clamp(22px, 6vw, 36px);      /* animal size */
    }

    /* Page container */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', 'Montserrat', system-ui, sans-serif;
      background: #f6f8fa;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden; /* NO page scroll */
    }

    /* Card */
    .game-card {
      background: #fff;
      border-radius: 16px;
      border: 1.5px solid #e0e0e0;
      padding: 18px 8px 12px 8px;
      width: min(98vw, 860px);
      height: 98vh;                /* fits the screen with tiny breathing room */
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;
    }

    .game-header-bar {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .timer-badge, .error-badge {
      background: #f0f2f5;
      color: #222;
      font-weight: 600;
      font-size: 0.60rem;
      border-radius: 999px;
      padding: 3px 10px;
      min-width: 45px;
      text-align: center;
      letter-spacing: 0.5px;
      border: 1px solid #e0e0e0;
    }
    .error-badge {
      color: #e53935;
      background: #fbe9e7;
      border: 1px solid #ffcdd2;
    }

    .header {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin: 0;
      color: #222;
    }
    .subheader {
      font-size: 0.92rem;
      margin: 0;
      color: #666;
      font-weight: 600;
    }

    .message {
      font-weight: bold;
      font-size: 1rem;
      margin: 2px 0;
      color: #1976d2;
      min-height: 32px;
      text-align: center;
    }
    .message.error { color: #e53935; animation: shake 0.3s; }
    .message.success { color: #43a047; animation: pop 0.4s; }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      50% { transform: translateX(6px); }
      75% { transform: translateX(-6px); }
      100% { transform: translateX(0); }
    }
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    /* GRID — always 4 columns */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: var(--gap);
      justify-items: center;
      align-items: end;
      margin: 0;
    }
    .game-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    /* Drop targets */
    .drop-box {
      width: var(--box);
      height: var(--box);
      border: 2.5px solid #e0e0e0;
      border-radius: calc(var(--box) * 0.33);
      background: #f6f8fa;
      position: relative;
      overflow: hidden;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .drop-box.active { border-color: #ff9800; background: #fff3e0; }

    /* House / Character / Animal sizes follow variables */
    .house,
    .house img,
    .house svg { width: var(--box) !important; height: var(--box) !important; object-fit: contain; display:block; }

    .character-svg,
    .character-svg img,
    .character-svg svg { width: var(--charW) !important; height: var(--charH) !important; object-fit: contain; display:block; }

    .animal,
    .animal img,
    .animal svg { width: var(--animal) !important; height: var(--animal) !important; object-fit: contain; display:block; }

    .house, .character-svg, .animal { transition: transform 0.18s; border-radius: 18px; }
    .house:hover, .character-svg:hover, .animal:hover { transform: scale(1.08) translateY(-2px); box-shadow: 0 4px 16px #ffd18044; z-index: 10; }
    .character-svg.bounce { animation: bounce 0.4s; }
    @keyframes bounce { 0%{transform:translateY(0)} 50%{transform:translateY(-10px)} 100%{transform:translateY(0)} }
    .character-svg.glow .head, .character-svg.glow .body { filter: drop-shadow(0 0 10px #ff9800); }

    .game-stats { display: flex; gap: 16px; font-size: 1rem; margin-bottom: 10px; color: #333; font-weight: 600; }
    .game-stats span { background: #f0f2f5; border-radius: 12px; padding: 4px 14px; min-width: 60px; text-align: center; }

    .clue-box {
      background: #f0f2f5;
      padding: 0 10px;
      width: 100%;
      max-width: 420px;
      border-radius: 18px;
      font-size: 0.75rem;
      margin: 4px 0 0 0;
      box-sizing: border-box;
      color: #333;
      word-break: break-word;
    }

    .answer-row { margin: 16px 0 0 0; display: flex; gap: 10px; align-items: center; justify-content: center; }
    #answerInput { font-size: 1.1rem; padding: 8px 16px; border-radius: 12px; border: 2px solid #e0e0e0; outline: none; min-width: 140px; background:#fff; color:#222; }
    #answerInput:focus { border-color: #ff9800; }
    #submitBtn, #resetBtn {
      font-size: 1.1rem; padding: 8px 20px; border-radius: 12px; border: none;
      background: #ff9800; color: #fff; font-weight: 700; cursor: pointer;
      box-shadow: 0 1px 4px #ffd18044; transition: background 0.2s, transform 0.15s;
    }
    #submitBtn:disabled, #resetBtn:disabled { background:#e0e0e0; color:#aaa; cursor:not-allowed; }
    #submitBtn:hover:not(:disabled), #resetBtn:hover:not(:disabled) { background:#fb8c00; transform:scale(1.05); }

    /* Modal */
    .modal { position: fixed; inset: 0; background: rgba(44, 62, 80, 0.10);
      display: none; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .modal-content {
      background:#fff; border-radius:28px; box-shadow:0 8px 32px rgba(31,38,135,0.1);
      padding:32px 18px; text-align:center; font-size:1.05rem; color:#222;
      min-width:220px; max-width:90vw; animation: pop 0.4s;
    }
    .modal-content button { margin-top:18px; }

    /* Character choice buttons */
    .character-select-row { display: flex; justify-content: center; gap: 16px; margin: 4px 0 0 0; flex-wrap: wrap; }
    .character-select {
      font-size: 1.1rem; padding: 8px 18px; border-radius:12px; border:none;
      background:#f0f2f5; color:#060606; font-weight:700; cursor:pointer;
      transition: background 0.2s, color 0.2s, transform 0.15s;
    }
    .character-select:active { background:#ff9800; color:#fff; transform:scale(0.97); }
    .character-select[disabled] { background:#e0e0e0; color:#aaa; cursor:not-allowed; }
    .select-blue{ background:#e3f2fd; color:#1976d2;}
    .select-purple{ background:#ede7f6; color:#ca8bfe;}
    .select-pink{ background:#fce4ec; color:#eb6ed0;}
    .select-white{ background:#f5f5f5; color:#222;}
    .character-svg.white img, .character-svg.white svg { width:85% !important; height:85% !important; margin:0 auto; display:block; }

    /* Keep your mobile typography tweaks, but DO NOT change columns */
    @media (max-width: 700px) {
      .header { font-size: 1.25rem; text-align: center; }
      .subheader { font-size: 1rem; margin-top: 10px; }
      .timer-badge, .error-badge { font-size: 0.85rem; padding: 4px 8px; min-width: 40px; }
      .clue-box { padding: 10px 4vw; font-size: 0.9rem; }
      .answer-row { flex-direction: column; gap: 8px; margin-top: 16px; }
      #answerInput, #submitBtn, #resetBtn { font-size: 1rem; padding: 8px 12px; width: 100%; max-width: 300px; }
      .modal-content { font-size: 1rem; padding: 20px 10px; }
      .character-select { font-size: 1rem; padding: 6px 14px; }
    }
  </style>
</head>
<body>
  <div class="game-card">
    <div class="game-header-bar">
      <span class="timer-badge" id="timer">00:00</span>
      <span class="error-badge">Errors: <span id="errorCount">0</span> / 3</span>
    </div>

    <div class="header">Find the Zebra</div>
    <div class="message" id="messageBox"></div>

    <div class="game-grid">
      <div class="game-col">
        <div class="house" draggable="true" data-name="red"><img src="redHouse.svg" alt="Red House" /></div>
        <div class="character-svg blue" draggable="true" data-name="blue"><img src="blue.svg" alt="Blue Character" class="character-img" /></div>
        <div class="animal" draggable="true" data-name="flamingo"><img src="flamingo.svg" alt="flamingo" /></div>
        <div class="drop-box" data-index="0"></div>
      </div>
      <div class="game-col">
        <div class="house" draggable="true" data-name="orange"><img src="orangeHouse.svg" alt="Orange House" /></div>
        <div class="character-svg purple" draggable="true" data-name="purple"><img src="purple.svg" alt="Purple Character" class="character-img" /></div>
        <div class="animal" draggable="true" data-name="horse"><img src="horse.svg" alt="horse" style="filter:sepia(100%) saturate(500%) brightness(0.7);" /></div>
        <div class="drop-box" data-index="1"></div>
      </div>
      <div class="game-col">
        <div class="house" draggable="true" data-name="yellow"><img src="yellowHouse.svg" alt="Yellow House" /></div>
        <div class="character-svg pink" draggable="true" data-name="pink"><img src="pink.svg" alt="Pink Character" class="character-img" /></div>
        <div class="animal" draggable="true" data-name="mouse"><img src="Rat.svg" alt="mouse" style="filter:grayscale(100%) brightness(0.7);" /></div>
        <div class="drop-box" data-index="2"></div>
      </div>
      <div class="game-col">
        <div class="house" draggable="true" data-name="green"><img src="greenHouse.svg" alt="Green House" /></div>
        <div class="character-svg white" draggable="true" data-name="white"><img src="white.svg" alt="White Character" class="character-img" /></div>
        <div class="animal" draggable="true" data-name="zebra"><img src="Zebra.svg" alt="zebra" /></div>
        <div class="drop-box" data-index="3"></div>
      </div>
    </div>

    <div class="subheader">Who has the zebra?</div>
    <div class="character-select-row">
      <button class="character-select select-blue" data-name="blue">Blue</button>
      <button class="character-select select-purple" data-name="purple">Purple</button>
      <button class="character-select select-pink" data-name="pink">Pink</button>
      <button class="character-select select-white" data-name="white">White</button>
    </div>

    <div class="clue-box" id="clueBox">
      <p><strong>Clue 1:</strong> The pink character lives in the leftmost house.</p>
      <p><strong>Clue 2:</strong> The horse lives in the green house.</p>
      <p><strong>Clue 3:</strong> The flamingo is kept in the orange house.</p>
      <p><strong>Clue 4:</strong> The green house is immediately to the right of the orange house.</p>
      <p><strong>Clue 5:</strong> The red house is immediately to the left of the orange house.</p>
      <p><strong>Clue 6:</strong> The blue character lives immediately to the left of the flamingo’s house.</p>
      <p><strong>Clue 7:</strong> The purple character loves flamingos.</p>
      <p><strong>Clue 8:</strong> The mouse is in the leftmost house.</p>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content" id="modalContent"></div>
  </div>

  <script>
    // Timer & game state
    let timerInterval, seconds = 0, errors = 0, guesses = 0, maxGuesses = 3;
    const timerEl = document.getElementById('timer');
    const errorEl = document.getElementById('errorCount');
    const messageBox = document.getElementById('messageBox');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modalContent');

    function startTimer() {
      timerInterval = setInterval(() => {
        seconds++;
        let min = String(Math.floor(seconds / 60)).padStart(2, '0');
        let sec = String(seconds % 60).padStart(2, '0');
        timerEl.textContent = `${min}:${sec}`;
      }, 1000);
    }
    function stopTimer() { clearInterval(timerInterval); }
    function showModal(msg) {
      modalContent.innerHTML = msg + `<br><button onclick='resetGame()' id='modalResetBtn'>Play Again</button>`;
      modal.style.display = 'flex';
      setTimeout(() => { document.getElementById('modalResetBtn').focus(); }, 100);
    }
    function hideModal() { modal.style.display = 'none'; }

    function resetGame() {
      stopTimer();
      seconds = 0; errors = 0; guesses = 0;
      timerEl.textContent = '00:00';
      errorEl.textContent = '0';
      messageBox.textContent = '';
      messageBox.className = 'message';
      document.querySelectorAll('.character-select').forEach(b => b.disabled = false);
      // clear drop boxes
      document.querySelectorAll('.drop-box').forEach(box => {
        box.innerHTML = '';
        box.style.background = '#f6f8fa';
      });
      hideModal();
      startTimer();
    }

    startTimer();

    // Character selection buttons
    document.querySelectorAll('.character-select').forEach(btn => {
      btn.onclick = function() {
        if (guesses >= maxGuesses) return;
        guesses++;
        const selected = btn.dataset.name;
        if (selected === "blue") {
          stopTimer();
          messageBox.textContent = `✔ Correct! You found the zebra owner in ${timerEl.textContent}`;
          messageBox.className = 'message success';
          document.querySelectorAll('.character-select').forEach(b => b.disabled = true);
          showModal(`<b>🎉 Congratulations!</b><br>You found the zebra owner in <b>${timerEl.textContent}</b>!`);
        } else {
          errors++;
          errorEl.textContent = errors;
          messageBox.textContent = "❌ Try again!";
          messageBox.className = 'message error';
          if (guesses >= maxGuesses) {
            messageBox.textContent = "❌ No more guesses! Game over.";
            document.querySelectorAll('.character-select').forEach(b => b.disabled = true);
            stopTimer();
            showModal(`<b>Game Over</b><br>No more guesses!<br>The correct answer was <b>blue</b>.`);
          }
        }
      };
    });

    // Lighten color helper
    function lightenColor(hex, percent) {
      hex = hex.replace(/^#/, '');
      if (hex.length === 3) hex = hex.split('').map(x => x + x).join('');
      let num = parseInt(hex, 16);
      let r = (num >> 16) & 0xFF, g = (num >> 8) & 0xFF, b = num & 0xFF;
      r = Math.round(r + (255 - r) * percent);
      g = Math.round(g + (255 - g) * percent);
      b = Math.round(b + (255 - b) * percent);
      return `rgb(${r},${g},${b})`;
    }

    // Update drop box background from house color
    function updateDropBoxBackground(box) {
      const houseWrapper = box.querySelector('[data-category="house"]');
      if (houseWrapper) {
        let svg = houseWrapper.querySelector('svg');
        let color = svg?.querySelector('polygon')?.getAttribute('fill') || svg?.querySelector('rect')?.getAttribute('fill');
        if (!color) {
          let img = houseWrapper.querySelector('img');
          if (img && img.src) {
            let match = img.src.match(/([a-zA-Z]+)House\.svg$/);
            if (match) {
              const colorName = match[1].toLowerCase();
              const colorMap = { red: '#f44336', orange: '#ff9800', yellow: '#ffeb3b', green: '#8bc34a' };
              color = colorMap[colorName];
            }
          }
        }
        if (color) { box.style.background = lightenColor(color, 0.45); return; }
      }
      box.style.background = '#f6f8fa';
    }

    // Category helper
    function getCategory(el) {
      if (el.classList.contains('house')) return 'house';
      if (el.classList.contains('character-svg')) return 'character';
      if (el.classList.contains('animal')) return 'animal';
      return '';
    }

    // Enable drag for source items
    document.querySelectorAll('.house, .character-svg, .animal').forEach(el => {
      el.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('name', el.dataset.name || '');
        e.dataTransfer.setData('category', getCategory(el));
        e.dataTransfer.setData('html', el.outerHTML);
      });
    });

    // Drop zones
    document.querySelectorAll('.drop-box').forEach(box => {
      box.addEventListener('dragover', e => { e.preventDefault(); box.classList.add('active'); });
      box.addEventListener('dragleave', e => { box.classList.remove('active'); updateDropBoxBackground(box); });
      box.addEventListener('drop', e => {
        e.preventDefault();
        box.classList.remove('active');
        let category = e.dataTransfer.getData('category');

        // Remove previous of same category
        let prev = box.querySelector(`[data-category="${category}"]`);
        if (prev) prev.remove();

        // Wrapper to allow positioning
        let wrapper = document.createElement('div');
        wrapper.dataset.category = category;
        wrapper.style.position = "absolute";
        wrapper.style.margin = "0";
        wrapper.style.pointerEvents = "auto";
        wrapper.innerHTML = e.dataTransfer.getData('html');

        let dropped = wrapper.firstChild;
        dropped.setAttribute('draggable', 'true');

        if (category === "house") {
          // Fill the box
          wrapper.style.left = "0"; wrapper.style.top = "0";
          wrapper.style.width = "100%"; wrapper.style.height = "100%";
          wrapper.style.zIndex = "1";
          if (dropped.tagName === "SVG" || dropped.tagName === "IMG") {
            dropped.style.width = "100%";
            dropped.style.height = "100%";
            dropped.style.objectFit = "contain";
            dropped.style.display = "block";
            dropped.style.background = "none";
          }
        }

        if (category === "character") {
          // Bottom center
          wrapper.style.left = "50%";
          wrapper.style.top = "70%";
          wrapper.style.transform = "translate(-50%, -50%)";
          wrapper.style.zIndex = "2";
          // DO NOT set fixed px sizes; CSS handles .character-svg sizing responsively
        }

        if (category === "animal") {
          // Upper-left corner
          wrapper.style.left = "5px";
          wrapper.style.top = "30px";
          wrapper.style.zIndex = "3";
          // DO NOT set fixed px sizes; CSS handles .animal sizing responsively
        }

        box.appendChild(wrapper);
        updateDropBoxBackground(box);

        // Allow remove by dragging out / clicking
        wrapper.addEventListener('dragstart', () => { wrapper.remove(); updateDropBoxBackground(box); });
        wrapper.addEventListener('click', () => {
          if (wrapper.parentElement && wrapper.parentElement.classList.contains('drop-box')) {
            wrapper.remove(); updateDropBoxBackground(box);
          }
        });
      });
    });

    // Touch drag-and-drop support (no fixed px sizes)
    function isTouchDevice() { return 'ontouchstart' in window || navigator.maxTouchPoints > 0; }
    if (isTouchDevice()) {
      let touchCategory = '', touchHTML = '';
      let ghost = null;
      document.querySelectorAll('.house, .character-svg, .animal').forEach(el => {
        el.addEventListener('touchstart', function(e) {
          if (e.touches.length > 1) return;
          touchCategory = getCategory(el);
          touchHTML = el.outerHTML;
          // ghost preview
          ghost = el.cloneNode(true);
          ghost.style.position = 'fixed';
          ghost.style.pointerEvents = 'none';
          ghost.style.opacity = '0.7';
          ghost.style.zIndex = '9999';
          const rect = el.getBoundingClientRect();
          ghost.style.width = rect.width + 'px';
          ghost.style.height = rect.height + 'px';
          ghost.style.left = (e.touches[0].clientX - rect.width/2) + 'px';
          ghost.style.top = (e.touches[0].clientY - rect.height/2) + 'px';
          document.body.appendChild(ghost);
          document.body.style.overflow = 'hidden';
        });
        el.addEventListener('touchmove', function(e) {
          if (!ghost) return;
          const rect = ghost.getBoundingClientRect();
          ghost.style.left = (e.touches[0].clientX - rect.width/2) + 'px';
          ghost.style.top = (e.touches[0].clientY - rect.height/2) + 'px';
          e.preventDefault();
        });
        el.addEventListener('touchend', function(e) {
          if (!ghost) return;
          let dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
          while (dropTarget && !dropTarget.classList.contains('drop-box') && dropTarget !== document.body) {
            dropTarget = dropTarget.parentElement;
          }
          if (dropTarget && dropTarget.classList.contains('drop-box')) {
            // Remove previous of same category
            let prev = dropTarget.querySelector(`[data-category="${touchCategory}"]`);
            if (prev) prev.remove();

            // Wrapper
            let wrapper = document.createElement('div');
            wrapper.dataset.category = touchCategory;
            wrapper.style.position = "absolute";
            wrapper.style.margin = "0";
            wrapper.style.pointerEvents = "auto";
            wrapper.innerHTML = touchHTML;
            let dropped = wrapper.firstChild;
            dropped.setAttribute('draggable', 'true');

            if (touchCategory === "house") {
              wrapper.style.left = "0"; wrapper.style.top = "0";
              wrapper.style.width = "100%"; wrapper.style.height = "100%";
              wrapper.style.zIndex = "1";
              if (dropped.tagName === "SVG" || dropped.tagName === "IMG") {
                dropped.style.width = "100%";
                dropped.style.height = "100%";
                dropped.style.objectFit = "contain";
                dropped.style.display = "block";
                dropped.style.background = "none";
              }
            }
            if (touchCategory === "character") {
              wrapper.style.left = "50%";
              wrapper.style.top = "70%";
              wrapper.style.transform = "translate(-50%, -50%)";
              wrapper.style.zIndex = "2";
            }
            if (touchCategory === "animal") {
              wrapper.style.left = "5px";
              wrapper.style.top = "30px";
              wrapper.style.zIndex = "3";
            }

            dropTarget.appendChild(wrapper);
            updateDropBoxBackground(dropTarget);
            wrapper.addEventListener('touchstart', function() { wrapper.remove(); updateDropBoxBackground(dropTarget); });
            wrapper.addEventListener('click', function() {
              if (wrapper.parentElement && wrapper.parentElement.classList.contains('drop-box')) {
                wrapper.remove(); updateDropBoxBackground(dropTarget);
              }
            });
          }
          if (ghost) ghost.remove();
          ghost = null;
          document.body.style.overflow = '';
        });
      });
    }
  </script>
</body>
</html>
